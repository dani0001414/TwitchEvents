<!DOCTYPE html>
<html>

<head>
    <style>
        #wrapper {
            width: 100%;

            overflow: hidden;
            /* will contain if #first is longer than #second */
        }

        #player {
            width: 70%;
            float: left;
            /* add this */
            border: 1px solid gray;
        }

        #chat {
            border: 1px solid gray;
            overflow: hidden;
            /* if you don't want #second to wrap below #first */
        }
    </style>
</head>

<body>
    <!-- 1. The <iframe> (and video player) will replace this <div> tag. -->
    <div id="wrapper">
        <div id="player"></div>
        <div id="chat" onmouseover="stopInterval()" onmouseout="intervalo()" style="overflow-y: scroll; height:720px;"></div>
    </div>
    Offset eltoláts(second):
    <input type="number" id="myNumber">
    <button onclick="offsetSet()">Alkalmaz</button>

    <script>

        function getQueryVariable(variable) {
            var query = window.location.search.substring(1);
            var vars = query.split("&");
            for (var i = 0; i < vars.length; i++) {
                var pair = vars[i].split("=");
                if (pair[0] == variable) { return pair[1]; }
            }
            return (false);
        }

        var streamer = getQueryVariable("streamer");
        var fileID = getQueryVariable("fileid");
        var ytID = getQueryVariable("ytid");
        var offset = 0;


        /*Chat scroll automatic*/
        intervalo();
        var chatbottom;
        function scroll() {
            var elem = document.getElementById('chat');
            elem.scrollTop = elem.scrollHeight;
        }

        function intervalo() {
            chatbottom = setInterval(scroll, 300);
        }

        function stopInterval() {
            clearInterval(chatbottom);
        }
        // YoutubeCode
        var tag = document.createElement('script');

        tag.src = "https://www.youtube.com/iframe_api";
        var firstScriptTag = document.getElementsByTagName('script')[0];
        firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);

        // 3. This function creates an <iframe> (and YouTube player)
        //    after the API code downloads.
        var player;
        function onYouTubeIframeAPIReady() {
            player = new YT.Player('player', {
                height: '720',
                width: '1280',
                videoId: ytID,
            });
        }

        //LoadChat
        function HttpGet(url, callback) {

            var xhttp = new XMLHttpRequest();
            xhttp.onreadystatechange = function () {
                if (this.readyState == 4 && this.status == 200) {
                    callback(xhttp.responseText);
                }
            };
            xhttp.open("GET", url, true);
            xhttp.send();

        }

        HttpGet("https://script.google.com/macros/s/AKfycbyZfzIBiOXUqwhW6Lp4--5y-8IjdFbKpHE-hxeYwqTDLsLxLicx/exec?fileID=" + fileID, chatLoad);




        var chatFlow;
        function chatLoad(data) {
            chatArray = data;
            chatArray = JSON.parse(chatArray);
            chatDom();
        }

        function chatDom() {
            var formatedChatArray = ["", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", ""];
            var countFrom = 0;
            var toCount, i;
            var previousCurrentTime, currentTime, length, message, fragmentLength, emoticonfrag;
            var offsetCur = offset;

            chatFlow = setInterval(function () {
                currentTime = player.getCurrentTime();

                if (currentTime < previousCurrentTime) {
                    countFrom = 0;
                }
                toCount = countFrom;

                while ((chatArray[toCount].contentOffsetSecond - offsetCur) < currentTime) {
                    toCount++;
                    //console.log('hovaszamol', toCount);
                }
                if ((toCount - countFrom > 19)) { countFrom = toCount - 19; }


                for (i = countFrom; i < toCount; i++) {
                    //console.log('hánydarab', toCount - countFrom);
                    formatedChatArray.shift();
                    length = Object.keys(chatArray[i].messageFragments).length;

                    message = "";
                    for (var j = 0; j < length; j++) {

                        if (chatArray[i].messageFragments[j].emoticon !== undefined) {

                            message += "<img src=\"https://static-cdn.jtvnw.net/emoticons/v1/" + chatArray[i].messageFragments[j].emoticon.emoticon_id + "/1.0\"></img> ";
                        } else { message += chatArray[i].messageFragments[j].text; }
                    }
                    formatedChatArray.push("<p style=\"margin-left: 5px; margin-right: 5px\" align=\"left\"><font size=\"2\">" + "<b>" + chatArray[i].displayName + "</b>: " + message + "</font></p>");
                    document.getElementById("chat").innerHTML = "Rögzített Chat:" + formatedChatArray[0] + formatedChatArray[1] + formatedChatArray[2] + formatedChatArray[3] + formatedChatArray[4] + formatedChatArray[5] + formatedChatArray[6] + formatedChatArray[7] + formatedChatArray[8] + formatedChatArray[9] +
                        formatedChatArray[10] + formatedChatArray[11] + formatedChatArray[12] + formatedChatArray[13] + formatedChatArray[14] + formatedChatArray[15] + formatedChatArray[16] + formatedChatArray[17] + formatedChatArray[18] + formatedChatArray[19];
                }
                countFrom = i;
                previousCurrentTime = currentTime;
            }, 300);
        }


        document.getElementById("myNumber").value = offset;
        function offsetSet() {
            formatedChatArray = ["", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", ""];
            var x = document.getElementById("myNumber").value;
            offset = x;
            //formatedChatArray = emptyChatArray;
            document.getElementById("chat").innerHTML = "";
            clearInterval(chatFlow);
            chatDom();
        }
    </script>
</body>

</html>